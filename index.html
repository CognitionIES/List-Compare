<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Excel Missing Items Finder</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 40px;
}
.container {
    max-width: 700px;
    margin: auto;
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 0 12px rgba(0,0,0,.1);
}
h2 { text-align: center; }
label { font-weight: bold; display: block; margin-top: 15px; }
input, button {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    font-size: 15px;
}
button {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 20px;
}
button:hover { background: #0056b3; }
a {
    display: block;
    margin-top: 15px;
    background: #28a745;
    color: white;
    text-align: center;
    padding: 10px;
    border-radius: 6px;
    text-decoration: none;
}
</style>
</head>

<body>
<div class="container">
    <h2>Excel Missing Items Finder</h2>

    <label>Select Excel file</label>
    <input type="file" id="file" accept=".xlsx">

    <label>First Column Letter</label>
    <input id="col1" value="A">

    <label>Second Column Letter</label>
    <input id="col2" value="B">

    <button onclick="process()">Process File</button>

    <div id="result"></div>
</div>

<script>
async function process() {
    const fileInput = document.getElementById("file");
    const col1 = document.getElementById("col1").value.toUpperCase();
    const col2 = document.getElementById("col2").value.toUpperCase();
    const result = document.getElementById("result");

    if (!fileInput.files.length) {
        alert("Please upload an Excel file");
        return;
    }

    const file = fileInput.files[0];
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data, { dense: true });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];

    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });

    const col1Idx = XLSX.utils.decode_col(col1);
    const col2Idx = XLSX.utils.decode_col(col2);

    const set1 = new Set();
    const set2 = new Set();

    for (let i = 1; i < rows.length; i++) {
        if (rows[i][col1Idx]) set1.add(String(rows[i][col1Idx]).trim());
        if (rows[i][col2Idx]) set2.add(String(rows[i][col2Idx]).trim());
    }

    const missingInA = [...set2].filter(x => !set1.has(x));
    const missingInB = [...set1].filter(x => !set2.has(x));

    const newColA = rows[0].length;
    const newColB = rows[0].length + 1;

    rows[0][newColA] = `In ${col2} missing from ${col1}`;
    rows[0][newColB] = `In ${col1} missing from ${col2}`;

    const maxLen = Math.max(missingInA.length, missingInB.length);

    while (rows.length <= maxLen) rows.push([]);

    for (let i = 0; i < maxLen; i++) {
        rows[i + 1][newColA] = missingInA[i] || "";
        rows[i + 1][newColB] = missingInB[i] || "";
    }

    const newSheet = XLSX.utils.aoa_to_sheet(rows);
    workbook.Sheets[sheetName] = newSheet;

    const wbout = XLSX.write(workbook, { bookType: "xlsx", type: "array" });
    const blob = new Blob([wbout], { type: "application/octet-stream" });

    const url = URL.createObjectURL(blob);
    result.innerHTML = `<a href="${url}" download="updated_${file.name}">Download Updated Excel</a>`;
}
</script>
</body>
</html>
